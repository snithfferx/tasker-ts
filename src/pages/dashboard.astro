---
import DashboardLayout from '@Layouts/DashboardLayout.astro';
import { DashboardAnalytics, SearchAndFilter } from '@Components/react/LazyLoader';
import DAnalytics from '@Components/react/DashboardAnalytics';
import ExportButton from '@Components/react/ExportButton.tsx';
import { verifyAuthentication, createAuthRedirect } from '@Utils/auth-server';

// Server-side authentication check
const authResult = await verifyAuthentication(Astro.cookies);
if (!authResult.isAuthenticated) {
  // Log the reason for debugging (remove in production)
  if (import.meta.env.DEV) {
    console.log('Dashboard access denied:', authResult.error);
  }
  return createAuthRedirect('/auth/login');
}
---

<DashboardLayout title="Dashboard">
  <div class="mb-6 flex justify-end">
    <ExportButton client:only="react" />
  </div>

  <!-- Search and Filter Section -->
  <div class="bg-white dark:bg-gray-700 dark:text-gray-100 shadow rounded-lg p-6 mb-6">
    <h2 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-4">Search & Filter</h2>
    <SearchAndFilter client:only="react" />
  </div>

  <!-- Analytics Dashboard -->
  <div class="space-y-6 dark:text-gray-100">
    <!-- <DashboardAnalytics client:only="react" /> -->
	<DAnalytics client:only="react" />
  </div>
</DashboardLayout>
